<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVTOTO | Premium Automated Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@700&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: #f8fafc;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .balance-font { font-family: 'JetBrains Mono', monospace; }

        /* Animation & Transition */
        .modal-container {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .modal-container.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .row-hover {
            transition: all 0.3s ease;
            border-left: 0px solid #6366f1;
        }

        .row-hover:hover {
            background: rgba(99, 102, 241, 0.1);
            border-left-width: 6px;
            transform: translateX(8px);
        }

        .glow-button {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        /* Success Pulse */
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        .status-active { animation: pulse-green 2s infinite; }
    </style>
</head>
<body class="p-4 md:p-10 antialiased">

    <div id="modalContainer" class="modal-container fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4">
        <div class="glass-panel w-full max-w-lg rounded-[2.5rem] p-10 border-indigo-500/30 shadow-2xl scale-95 transition-transform duration-300">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-2xl font-extrabold italic text-white flex items-center gap-3">
                    <i class="fas fa-plus-circle text-indigo-400"></i> ENTRY <span class="text-indigo-400">REKENING</span>
                </h3>
                <button onclick="toggleModal()" class="text-slate-500 hover:text-white transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] block mb-3 pl-1">Identitas Rekening (Nama / Bank)</label>
                    <input type="text" id="inputName" placeholder="Contoh: BCA KAS NEW / JERRY" 
                    class="w-full bg-slate-800/80 border border-slate-700 rounded-2xl px-6 py-5 outline-none focus:border-indigo-500 text-white font-semibold transition-all">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] block mb-3 pl-1">Saldo Deposit Awal</label>
                    <input type="number" id="inputSaldo" placeholder="Masukkan angka tanpa titik..." 
                    class="w-full bg-slate-800/80 border border-slate-700 rounded-2xl px-6 py-5 outline-none focus:border-indigo-500 text-white font-semibold transition-all">
                </div>
                
                <button onclick="submitToGoogle()" id="btnSubmit" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-extrabold py-5 rounded-2xl shadow-xl glow-button transition-all active:scale-95 flex items-center justify-center gap-3">
                    <i class="fas fa-cloud-upload-alt"></i> SIMPAN KE SYSTEM
                </button>
                <p class="text-[9px] text-center text-slate-500 uppercase font-bold tracking-widest mt-4">Data diproses secara otomatis oleh Google App Engine</p>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center gap-8 mb-16">
            <div class="flex items-center gap-6">
                <div class="w-20 h-20 bg-indigo-600 rounded-[2rem] flex items-center justify-center shadow-2xl shadow-indigo-500/40 transform -rotate-3 hover:rotate-0 transition-transform cursor-pointer">
                    <i class="fas fa-chart-line text-3xl text-white"></i>
                </div>
                <div>
                    <h1 class="text-4xl font-extrabold italic tracking-tighter uppercase">TVTOTO <span class="text-indigo-500">PRO</span></h1>
                    <div class="flex items-center gap-2 mt-2">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_8px_#10b981]"></span>
                        <span id="statusLabel" class="text-[10px] font-black text-slate-500 tracking-[0.3em] uppercase italic">System Operational</span>
                    </div>
                </div>
            </div>

            <div class="flex flex-wrap justify-center gap-4">
                <button onclick="toggleModal()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-10 py-5 rounded-2xl font-black text-xs uppercase tracking-widest transition-all active:scale-95 glow-button flex items-center gap-3">
                    <i class="fas fa-plus"></i> Tambah Data
                </button>
                <div class="glass-panel px-10 py-5 rounded-2xl border-indigo-500/20 text-right min-w-[200px]">
                    <p class="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-1">Total Liquidity</p>
                    <h2 id="grandTotal" class="text-3xl font-extrabold balance-font text-white italic">Rp 0</h2>
                </div>
            </div>
        </header>

        <div class="flex flex-col md:flex-row gap-4 mb-10">
            <div class="relative flex-grow">
                <i class="fas fa-search absolute left-7 top-1/2 -translate-y-1/2 text-slate-500"></i>
                <input type="text" id="searchInput" onkeyup="filterList()" placeholder="Cari master rekening atau nama bank..." 
                class="w-full pl-16 pr-8 py-6 rounded-3xl bg-slate-800/40 border border-slate-700 outline-none text-white focus:ring-4 focus:ring-indigo-500/20 transition-all font-medium">
            </div>
        </div>

        <div class="glass-panel rounded-[3rem] overflow-hidden shadow-2xl mb-10">
            <div class="grid grid-cols-12 px-10 py-8 bg-slate-800/60 border-b border-white/5 text-[10px] font-black text-slate-400 uppercase tracking-[0.3em]">
                <div class="col-span-8">Identity & Bank Network</div>
                <div class="col-span-4 text-right">Balance Analytics</div>
            </div>
            <div id="dataList" class="divide-y divide-white/5">
                </div>
        </div>
        
        <p class="text-center text-slate-600 text-[10px] font-bold uppercase tracking-widest pb-10 italic">
            &copy; 2024 TVTOTO GLOBAL MONITORING SYSTEM - SECURED BY END-TO-END ENCRYPTION
        </p>
    </div>

    <script>
        // CONFIGURATION
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSsnosH5qmA4ADdf2nPeM7k1JdZI-RDhgA4Y8GgSmB5Qs-9MCaaEdeykDzRGFjjcrjhotKKSyd5J_D0/pub?gid=1655913458&single=true&output=csv';
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbw39FKs85E8cudsRLcaNQ3X3TiAfLuG1Kd41uRXoTntzrZRl6SHvEGQVWXnwmnnDRWh8Q/exec'; 

        let masterData = [];

        function toggleModal() {
            document.getElementById('modalContainer').classList.toggle('active');
        }

        async function submitToGoogle() {
            const nama = document.getElementById('inputName').value;
            const saldo = document.getElementById('inputSaldo').value;
            const btn = document.getElementById('btnSubmit');

            if(!nama || !saldo) {
                alert("Mohon lengkapi Nama dan Saldo!");
                return;
            }

            btn.innerHTML = '<i class="fas fa-spinner animate-spin"></i> MEMPROSES...';
            btn.disabled = true;

            try {
                // Mengirim data menggunakan POST ke Web App
                await fetch(scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    body: JSON.stringify({ nama: nama, saldo: saldo })
                });

                alert("DATA BERHASIL DIKIRIM!\nMohon tunggu sekitar 30-60 detik agar Google Sheets memproses data baru ke file CSV.");
                document.getElementById('inputName').value = '';
                document.getElementById('inputSaldo').value = '';
                toggleModal();
                loadData();
            } catch (error) {
                console.error("Error:", error);
                alert("Gagal mengirim data. Pastikan Script URL benar.");
            } finally {
                btn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> SIMPAN KE SYSTEM';
                btn.disabled = false;
            }
        }

        async function loadData() {
            try {
                const response = await fetch(csvUrl);
                const text = await response.text();
                Papa.parse(text, { 
                    header: false, 
                    skipEmptyLines: true, 
                    complete: (results) => processData(results.data) 
                });
            } catch (e) { 
                console.error("Connection lost"); 
            }
        }

        function processData(rows) {
            let temp = []; let total = 0;
            rows.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    let content = cell ? cell.toString().trim() : "";
                    if (content.includes('/') || content.toUpperCase().includes('OCBC') || content.toUpperCase().includes('KAS')) {
                        let rawSaldo = (rows[10] && rows[10][colIndex]) || (rows[rowIndex + 1] && rows[rowIndex + 1][colIndex]) || "0";
                        let saldoVal = parseInt(rawSaldo.replace(/[^0-9]/g, '')) || 0;
                        if (content.length > 5 && !temp.some(x => x.name === content)) {
                            temp.push({ name: content, saldo: saldoVal, bank: detectBank(content) });
                            total += saldoVal;
                        }
                    }
                });
            });
            masterData = temp.sort((a, b) => b.saldo - a.saldo);
            renderList(masterData);
            document.getElementById('grandTotal').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(total);
            document.getElementById('statusLabel').innerText = "Last Sync: " + new Date().toLocaleTimeString('id-ID');
        }

        function renderList(data) {
            const container = document.getElementById('dataList');
            container.innerHTML = '';
            
            data.forEach(item => {
                const isZero = item.saldo === 0;
                container.innerHTML += `
                    <div class="grid grid-cols-12 px-10 py-10 row-hover items-center ${isZero ? 'opacity-30 grayscale' : ''}">
                        <div class="col-span-8 flex items-center gap-6">
                            <div class="w-14 h-14 rounded-2xl glass-panel flex items-center justify-center text-[11px] font-black text-indigo-400 border-indigo-500/20 shadow-xl">
                                ${item.bank.substring(0,3)}
                            </div>
                            <div>
                                <h4 class="font-extrabold text-white text-lg uppercase italic tracking-tight">${item.name}</h4>
                                <div class="flex items-center gap-3 mt-1">
                                    <span class="text-[9px] font-black text-slate-500 uppercase tracking-[0.2em]">${item.bank} NETWORK</span>
                                    ${!isZero ? '<span class="w-2 h-2 bg-emerald-500 rounded-full status-active"></span>' : ''}
                                </div>
                            </div>
                        </div>
                        <div class="col-span-4 text-right">
                            <p class="text-2xl font-bold text-white balance-font tracking-tighter leading-none">Rp ${new Intl.NumberFormat('id-ID').format(item.saldo)}</p>
                            <p class="text-[9px] font-black uppercase tracking-[0.3em] mt-3 ${isZero ? 'text-slate-600' : 'text-emerald-500'}">
                                ${isZero ? 'Offline System' : 'Liquid Assets'}
                            </p>
                        </div>
                    </div>
                `;
            });
        }

        function detectBank(str) {
            const banks = ["BCA", "BRI", "BNI", "MANDIRI", "OCBC", "DANAMON", "SINARMAS", "MAYBANK"];
            for (let b of banks) { if (str.toUpperCase().includes(b)) return b; }
            return "BANK";
        }

        function filterList() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            renderList(masterData.filter(d => d.name.toLowerCase().includes(q)));
        }

        // Initial Load
        loadData();
        // Refresh every 60 seconds
        setInterval(loadData, 60000);
    </script>
</body>
</html>
