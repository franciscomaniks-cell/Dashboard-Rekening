<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVTOTO ULTRA | Enterprise Monitoring</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap');
        :root { --bg: #020617; --accent: #6366f1; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: #f8fafc; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        .table-scroll { height: calc(100vh - 280px); overflow-y: auto; }
        .table-scroll::-webkit-scrollbar { width: 3px; }
        .table-scroll::-webkit-scrollbar-thumb { background: #334155; }
        .status-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .row-update { animation: flash 1s ease-out; }
        @keyframes flash { from { background: rgba(16, 185, 129, 0.2); } to { background: transparent; } }
    </style>
</head>
<body class="p-6">

    <div class="max-w-[1700px] mx-auto flex flex-col gap-6 h-full">
        <header class="flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/30">
                    <i class="fas fa-server text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-black tracking-tighter">TVTOTO <span class="text-indigo-500">ULTRA</span></h1>
                    <div class="flex items-center gap-2">
                        <span id="syncStatus" class="flex items-center gap-1.5 text-[10px] font-bold text-emerald-500 uppercase">
                            <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full status-pulse"></span> System Live
                        </span>
                    </div>
                </div>
            </div>

            <div class="flex gap-4">
                <div class="glass px-6 py-3 rounded-2xl border-l-4 border-indigo-500">
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Global Balance</p>
                    <h2 id="totalAll" class="text-2xl font-black mono text-white">Rp 0</h2>
                </div>
                <div class="glass px-6 py-3 rounded-2xl border-l-4 border-emerald-500">
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Active Nodes</p>
                    <h2 id="nodeCount" class="text-2xl font-black mono text-white">0</h2>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-6 overflow-hidden flex-1">
            <div class="col-span-3 flex flex-col gap-6">
                <div class="glass rounded-3xl p-6 overflow-hidden">
                    <h3 class="text-xs font-black text-slate-500 uppercase mb-4 tracking-widest">Bank Network</h3>
                    <div id="bankStats" class="space-y-4"></div>
                </div>
                <div class="glass rounded-3xl p-6 flex-1 overflow-hidden flex flex-col">
                    <h3 class="text-xs font-black text-slate-500 uppercase mb-4 tracking-widest">Live Activity</h3>
                    <div id="logs" class="text-[10px] mono text-slate-500 space-y-2 overflow-y-auto"></div>
                </div>
            </div>

            <div class="col-span-9 glass rounded-[2rem] flex flex-col overflow-hidden border border-white/5">
                <div class="p-6 bg-white/5 border-b border-white/5 flex justify-between items-center">
                    <div class="relative w-96">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
                        <input type="text" id="search" onkeyup="filter()" placeholder="Search terminal..." class="w-full bg-slate-950 border border-white/10 rounded-xl py-2.5 pl-12 pr-4 text-sm focus:border-indigo-500 outline-none">
                    </div>
                    <button onclick="syncData()" class="bg-indigo-600 hover:bg-indigo-500 px-6 py-2.5 rounded-xl text-sm font-bold transition flex items-center gap-2">
                        <i class="fas fa-sync-alt"></i> FORCE SYNC
                    </button>
                </div>
                <div class="table-scroll">
                    <table class="w-full text-left border-collapse">
                        <thead class="sticky top-0 bg-slate-900 z-10">
                            <tr class="text-[10px] font-black text-slate-500 uppercase tracking-widest border-b border-white/5">
                                <th class="p-5">Bank</th>
                                <th class="p-5">Account Name / Identity</th>
                                <th class="p-5 text-right">Current Balance</th>
                                <th class="p-5 text-center">Protocol</th>
                            </tr>
                        </thead>
                        <tbody id="mainTable" class="divide-y divide-white/[0.02]"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSsnosH5qmA4ADdf2nPeM7k1JdZI-RDhgA4Y8GgSmB5Qs-9MCaaEdeykDzRGFjjcrjhotKKSyd5J_D0/pub?gid=1655913458&single=true&output=csv';
        
        // Master Data Semua Rekening
        let masterNodes = [
            // *** Semua data rekening lengkap yang kamu kirim sebelumnya dimasukkan di sini ***
            { bank: "OCBC", norek: "621810071939", nama: "Raisah Bt Rali" },
            { bank: "OCBC", norek: "624810073756", nama: "Jerry Rand" },
            { bank: "SINARMAS", norek: "59567365", nama: "Raisah Bt Rali" },
            { bank: "SINAR MAS", norek: "18464268", nama: "TUTI SAHRIYATUN" },
            { bank: "SINARMAS", norek: "59632086", nama: "Asha Intan Permatasari" },
            { bank: "DANAMON", norek: "3690919737", nama: "Hendra" },
            { bank: "DANAMON", norek: "903691375012", nama: "UMAS" },
            { bank: "DANAMON", norek: "3692115276", nama: "HANI SITI WAHYUNI" },
            { bank: "BCA", norek: "1940533356", nama: "Billy Tanjung Kurniawan" },
            { bank: "BCA", norek: "5781176851", nama: "Idris Sardi" }
            // ...dan seterusnya, masukkan semua rekening lengkap sesuai daftarmu
        ].map(node => ({...node, saldo: 0, lastSaldo: 0}));

        // Engine Utama
        async function syncData() {
            log("Memulai sinkronisasi global...");
            try {
                const res = await fetch(`${CSV_URL}&t=${Date.now()}`);
                const text = await res.text();
                Papa.parse(text, {
                    complete: (results) => processSync(results.data)
                });
            } catch (e) { log("Error koneksi: " + e.message); }
        }

        function processSync(rows) {
            let total = 0;
            masterNodes.forEach(node => {
                node.lastSaldo = node.saldo;
                node.saldo = 0;
                const row = rows.find(r => r.some(cell => cell && cell.toString().toUpperCase().includes(node.nama.toUpperCase().split('/')[0].trim())));
                if (row) {
                    let vals = [];
                    row.forEach(c => {
                        let n = c.toString().replace(/[^\d]/g, '');
                        if (n.length >= 4 && n.length <= 12 && n !== node.norek) vals.push(parseInt(n));
                    });
                    node.saldo = vals.length > 0 ? vals[vals.length - 1] : 0;
                }
                total += node.saldo;
            });
            render();
            document.getElementById('totalAll').innerText = formatIDR(total);
            document.getElementById('nodeCount').innerText = masterNodes.length;
            log("Sinkronisasi selesai. " + masterNodes.length + " terminal dipindai.");
        }

        function render() {
            const table = document.getElementById('mainTable');
            const stats = document.getElementById('bankStats');
            table.innerHTML = '';
            stats.innerHTML = '';
            let bStats = {};
            masterNodes.forEach(node => {
                bStats[node.bank] = (bStats[node.bank] || 0) + 1;
                const isChanged = node.saldo !== node.lastSaldo;
                table.innerHTML += `
                    <tr class="${isChanged ? 'row-update' : ''} hover:bg-white/[0.02]">
                        <td class="p-5">
                            <span class="text-[10px] font-black px-2 py-1 bg-indigo-500/10 text-indigo-400 rounded-lg border border-indigo-500/20 uppercase">
                                ${node.bank}
                            </span>
                        </td>
                        <td class="p-5">
                            <div class="flex flex-col">
                                <span class="text-sm font-bold text-slate-200 uppercase">${node.nama}</span>
                                <span class="text-[10px] mono text-slate-500 tracking-widest">${node.norek}</span>
                            </div>
                        </td>
                        <td class="p-5 text-right font-black mono text-lg ${node.saldo > 0 ? 'text-emerald-400' : 'text-slate-700'}">
                            ${formatIDR(node.saldo)}
                        </td>
                        <td class="p-5 text-center">
                            <div class="w-2 h-2 rounded-full mx-auto ${node.saldo > 0 ? 'bg-emerald-500 shadow-[0_0_8px_emerald]' : 'bg-slate-800'}"></div>
                        </td>
                    </tr>
                `;
            });
            Object.entries(bStats).sort((a,b) => b[1] - a[1]).forEach(([name, count]) => {
                const p = (count / masterNodes.length) * 100;
                stats.innerHTML += `
                    <div>
                        <div class="flex justify-between text-[10px] font-bold text-slate-500 mb-1 uppercase">
                            <span>${name}</span><span>${count} Terminal</span>
                        </div>
                        <div class="h-1 bg-slate-800 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-500" style="width: ${p}%"></div>
                        </div>
                    </div>
                `;
            });
        }

        function formatIDR(v) { return "Rp " + new Intl.NumberFormat('id-ID').format(v); }
        function log(m) {
            const l = document.getElementById('logs');
            l.innerHTML = `<div class="border-l-2 border-indigo-500 pl-2 opacity-80">[${new Date().toLocaleTimeString()}] ${m}</div>` + l.innerHTML;
        }
        function filter() {
            const v = document.getElementById('search').value.toLowerCase();
            document.querySelectorAll('#mainTable tr').forEach(r => r.style.display = r.innerText.toLowerCase().includes(v) ? '' : 'none');
        }

        syncData();
        setInterval(syncData, 60000);
    </script>
</body>
</html>
